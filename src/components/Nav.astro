---
// Nav.astro
const pathname = Astro.url.pathname;

// Normalize paths (remove trailing slash except for "/")
const cleanPath = (p) => (p === "/" ? "/" : p.replace(/\/+$/, ""));

// Active if exact match or if current path is inside that section (e.g. /blog/post-1)
const isActive = (route) => {
  const p = cleanPath(pathname);
  return p === route || p.startsWith(route + "/");
};

const routes = ["/works", "/about", "/blog"];
---

<ul class="nav-bar" id="navBar" data-routes={JSON.stringify(routes)}>
  <li>
    <a href="/works" class:list={{ active: isActive("/works") }}>Works</a>
  </li>
  <li>
    <a href="/about" class:list={{ active: isActive("/about") }}>About</a>
  </li>
  <li>
    <a href="/blog" class:list={{ active: isActive("/blog") }}>Blog</a>
  </li>
</ul>

<style lang="scss">
  .nav-bar {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    list-style: none;
    width: max-content;
    padding: 0;
    z-index: 1000;
    gap: 8px;
    transition:
      top 0.25s ease,
      opacity 0.25s ease;
  }

  .nav-bar--hidden {
    top: -80px;
    opacity: 0;
  }

  /* ---------- DEFAULT (raised) ---------- */
  .nav-bar li {
    position: relative;
    background: rgba(255, 255, 255, 0.35);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    border-radius: var(--br);
    transition: backdrop-filter 0.15s ease;
  }

  .nav-bar a {
    padding: 0 14px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    text-decoration: none;
    white-space: nowrap;
    position: relative;
    z-index: 1;
    border-radius: var(--br);

    /* raised */
    box-shadow: 0 0 3px rgba(122, 122, 122, 0.9);
    transition:
      box-shadow 0.15s ease,
      color 0.15s ease;
  }

  /* pill background (hover + active) */
  .nav-bar a::before {
    content: "";
    position: absolute;
    inset: 0;
    // background: var(--highlight-gray, #c8c8c8);
    border-radius: var(--br);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  /* show pill on hover */
  .nav-bar li:hover a::before {
    opacity: 1;
  }

  /* active pill default */
  .nav-bar a.active::before {
    opacity: 1;
  }

  /* when hovering the nav, hide active pill (so only hovered shows) */
  .nav-bar:hover a.active::before {
    opacity: 0;
  }

  /* but if hovering the active item itself, show it */
  .nav-bar:hover li:hover a.active::before {
    opacity: 1;
  }

  /* ---------- PRESSED-IN STATES ---------- */
  /* active stays pressed in */
  .nav-bar a.active {
    box-shadow: none;
  }
  .nav-bar li:has(a.active) {
    background: rgba(255, 255, 255, 0.65);
  }

  /* hovered item becomes pressed in (and more opaque) */
  .nav-bar li:hover a {
    box-shadow: none;
  }
  .nav-bar li:hover {
    // background: rgba(255, 255, 255, 0.65);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  /* ---------- TOUCH DEVICES ---------- */
  @media (hover: none) {
    .nav-bar a {
      transition: none;
      color: #000 !important;
    }

    .nav-bar:hover a,
    .nav-bar a:hover {
      color: inherit !important;
    }

    /* keep active pill visible on touch */
    .nav-bar a.active::before {
      opacity: 1;
    }
  }
</style>
