---
// Nav.astro
const pathname = Astro.url.pathname;

// Normalize paths (remove trailing slash except for "/")
const cleanPath = (p) => (p === "/" ? "/" : p.replace(/\/+$/, ""));

// Active if exact match or if current path is inside that section (e.g. /blog/post-1)
const isActive = (route) => {
  const p = cleanPath(pathname);
  return p === route || p.startsWith(route + "/");
};

const routes = ["/works", "/about", "/blog"];
---

<ul class="nav-bar" id="navBar" data-routes={JSON.stringify(routes)}>
  <li>
    <a href="/works" class:list={{ active: isActive("/works") }}>Works</a>
  </li>
  <li>
    <a href="/about" class:list={{ active: isActive("/about") }}>About</a>
  </li>
  <li>
    <a href="/blog" class:list={{ active: isActive("/blog") }}>Blog</a>
  </li>
</ul>

<style lang="scss">
  .nav-bar {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    list-style: none;
    background-color: var(--gray);
    border: 3px solid var(--gray);
    border-radius: var(--br);
    width: max-content;
    padding: 0;
    z-index: 1000;
    overflow: hidden;
    transition:
      top 0.25s ease,
      opacity 0.25s ease;
      
  }

  .nav-bar--hidden {
    top: -80px;
    opacity: 0;
  }

  .nav-bar li {
    position: relative;
  }

  .nav-bar a {
    padding: 0 14px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    text-decoration: none;
    white-space: nowrap;
    transition: color 0.15s ease;
    position: relative;
    z-index: 1;
  }

  /* pill background (hover + active) */
  .nav-bar a::before {
    content: "";
    position: absolute;
    inset: 1px;
    background: var(--highlight-gray, #c8c8c8);
    border-radius: var(--br);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  /* show pill on hover */
  .nav-bar li:hover a::before {
    opacity: 1;
  }

  /* active pill default */
  .nav-bar a.active::before {
    opacity: 1;
  }

  /* when hovering the nav, hide active pill (so only hovered shows) */
  .nav-bar:hover a.active::before {
    opacity: 0;
  }

  /* but if hovering the active item itself, show it */
  .nav-bar:hover li:hover a.active::before {
    opacity: 1;
  }


  @media (hover: none) {
    .nav-bar a {
      transition: none;
      color: #000 !important;
    }

    .nav-bar:hover a,
    .nav-bar a:hover {
      color: inherit !important;
    }

    .nav-bar a.active::before {
      opacity: 1;
    }
  }
</style>
