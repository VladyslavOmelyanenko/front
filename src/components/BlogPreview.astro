---
const { blogPost } = Astro.props;

const dateText = (() => {
  const d = new Date(blogPost.postDate);
  const day = String(d.getDate()).padStart(2, "0");
  const month = String(d.getMonth() + 1).padStart(2, "0");
  const year = d.getFullYear();
  return `${day}.${month}.${year}`;
})();
---

<a href={"/blog/" + blogPost.slug}>
  <div class="blog-preview">
    <h2 class="blog-title">
      <span class="ticker" data-ticker>
        <span class="t1">{blogPost.title}</span>
        <span class="t2">{blogPost.title}</span>
      </span>
    </h2>

    <span class="blog-date">{dateText}</span>

    <p class="blog-short-description">
      <span class="ticker" data-ticker>
        <span class="t1">{blogPost.postDescription}</span>
        <span class="t2">{blogPost.postDescription}</span>
      </span>
    </p>
  </div>
</a>

<style lang="scss">
  @keyframes ticker {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .blog-preview {
    height: 42px;
    display: flex;
    gap: 10px;

    &:hover {
      .blog-title,
      .blog-short-description,
      .blog-date {
        background-color: var(--highlight-gray);
      }
    }

    .blog-title,
    .blog-short-description,
    .blog-date {
      border-radius: var(--br);
      background-color: var(--gray);
      text-align: center;
      padding: 0 8px;
      display: flex;
      align-items: center;
      white-space: nowrap;
      min-width: 0;
      overflow: hidden;
    }

    .blog-title {
      flex: 0 0 auto;
      width: max-content;
      max-width: 45%;
      min-width: 160px;
      margin: 0; /* because h2 */
    }

    .blog-short-description {
      flex: 1 1 auto;
      min-width: 0;
      overflow: hidden;
      position: relative;
    }

    /* =========================
     TICKER (final behavior)
     - JS adds .ticker--scrolling ONLY when cut off
     - Desktop: runs ONLY on hover
     - Touch: runs automatically
  ========================= */

    .ticker {
      display: inline-flex;
      white-space: nowrap;
      animation: none; /* no motion unless scrolling */
      animation-play-state: paused; /* paused by default */
    }

    .ticker.ticker--scrolling {
      animation: ticker var(--ticker-duration, 12s) linear infinite;
      animation-play-state: paused;
    }

    /* gap only when scrolling (prevents weird right gap when not animating) */
    .ticker.ticker--scrolling .t1,
    .ticker.ticker--scrolling .t2 {
      padding-right: 40px;
    }

    .blog-date {
      flex: 0 0 120px;
      width: 120px;
      justify-content: center;
    }
  }

  /* Desktop: animate only on hover */
  @media (hover: hover) and (pointer: fine) {
    .blog-preview:hover .ticker.ticker--scrolling {
      animation-play-state: running;
    }
  }

  /* Touch devices: run automatically (remove if you don't want auto-run on mobile) */
  @media (hover: none) {
    .ticker.ticker--scrolling {
      animation-play-state: running;
    }
  }

  @media (max-width: 768px) {
    .blog-preview {
      gap: 8px;
    }

    /* Title pill hugs text (no extra space) */
    .blog-preview .blog-title {
      flex: 0 0 auto;
      width: max-content;
      max-width: 100%;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden; /* ✅ keep tidy if it still overflows */
      text-overflow: ellipsis; /* optional */
    }

    .blog-preview .blog-date {
      display: none;
    }

    /* Description takes remaining room and can be cut off + ticker */
    .blog-preview .blog-short-description {
      flex: 1 1 auto;
      min-width: 0;
    }

    /* ✅ Mobile: run tickers automatically (but only when JS added ticker--scrolling) */
    .blog-preview .ticker.ticker--scrolling {
      animation-play-state: running !important;
    }

    /* keep the gap rule as-is (only applies while scrolling) */
  }
</style>
