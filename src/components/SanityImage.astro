---
import { urlFor } from "../lib/sanity.js";

const { value } = Astro.props;

// Support these shapes:
// 1) contentImage: { _type:"contentImage", size, image:{asset, alt, caption} }
// 2) captionedImage or plain image: { asset, alt, caption }
const img = value?.image ?? value ?? null;
const asset = img?.asset ?? null;

let src = "";
if (asset) {
  // urlFor can take an asset ref/object (recommended)
  src = urlFor(asset).width(1200).auto("format").url();
}

const alt = img?.alt || img?.caption || "";
const caption = img?.caption || null;

// Optional: size for layout hooks (only exists on contentImage)
const size = value?._type === "contentImage" ? value?.size : null;
---

{
  src && (
    <figure class={size ? `content-image size-${size}` : "content-image"}>
      <img src={src} alt={alt} loading="lazy" />
      {caption && <figcaption>{caption}</figcaption>}
    </figure>
  )
}
