---
import Layout from "../layouts/Layout.astro";
import Nav from "../components/Nav.astro";
import Feed from "../components/Feed.astro";
import { client } from "../lib/sanity.js";
import Post from "../components/Post.astro";
import { getWorkPost as getPostBySlug } from "../data/works"; // rename later if you like

export async function getStaticPaths() {
  const slugs = await client.fetch(`
    *[_type == "post" && defined(slug.current) && !(_id in path("drafts.**"))]{
      "slug": slug.current
    }
  `);

  return slugs.map(({ slug }) => ({
    params: { slug },
    props: { postSlug: slug },
  }));
}

const { postSlug } = Astro.props;
const post = await getPostBySlug(postSlug);
if (!post) return Astro.redirect("/404");
---

<Layout title={`Dzastin’s’—${post.title}`}>
  <Nav />
  <Feed>
    <Post post={post} />
  </Feed>
</Layout>
